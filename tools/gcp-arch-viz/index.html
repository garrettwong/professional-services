<!DOCTYPE html>
<!--
/*
 * Copyright (C) 2018 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License"); you may not
 * use this file except in compliance with the License. You may obtain a copy of
 * the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
 * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
 * License for the specific language governing permissions and limitations under
 * the License.
 */
-->
<meta charset="utf-8">
<style>
  /* set the CSS */
  svg {
    border: 2px saddlebrown solid;
  }
  .node circle {
    fill: #fff;
    stroke: steelblue;
    stroke-width: 3px;
  }

  .node text {
    font: 12px sans-serif;
  }

  .node--internal text {
    text-shadow: 0 1px 0 #fff, 0 -1px 0 #fff, 1px 0 0 #fff, -1px 0 0 #fff;
  }

  .link {
    fill: none;
    stroke: #ccc;
    stroke-width: 2px;
  }
</style>
<style>
  div.tooltip {	
    position: absolute;			
    text-align: center;			
    width: 120px;					
    height: 42px;					
    padding: 12px;				
    font: 12px sans-serif;		
    background: lightsteelblue;	
    border: 0px;
    opacity: 0.5;
    border-radius: 8px;			
    pointer-events: none;
  }
</style>

<body>
  <button id="btn-reset-zooms">Reset Zoom</button>
  <input type="text" id="search-text">
  <button id="btn-search">Search</button>
  <input type="radio" name="orientation" value="vertical" checked> Vertical<br>
  <input type="radio" name="orientation" value="horizontal"> Horizontal<br>

  <input type="checkbox" checked id="cbxExpanded"> Expanded <br />


  <script src="//d3js.org/d3.v5.min.js"></script>

  <script src="vertical-tree.js"></script>
  <script src="horizontal-tree.js"></script>
  <script>
    var csv_data;
    var treeData, margin, tree, table, svg, g;

    // FILENAME is static, but add a random variable to the end to prevent browser caching,
    // aka - "I changed the content of the file, but why isn't that stuff drawing?!"
    // var FILENAME = "gcp-data.csv" + "?nocache=" + Date.now();
    var FILENAME = "forseti-resource-generator/output/resources.csv" + "?nocache=" + Date.now();

    var FILE_LOAD_START_TIME = new Date().toLocaleTimeString();
    console.log("Loading file: " + FILENAME + ", start time: " + FILE_LOAD_START_TIME);

    window.onload = function () {
      initVerticalTree(FILENAME);
    };

    var radios = document.querySelectorAll('input[name="orientation"]');

    function changeHandler(event) {
      console.log(event);
      console.log(this.value);

      if (this.value === 'horizontal') {
        svg.remove();

        document.getElementById('cbxExpanded').checked = true;
        initHorizontalTree(FILENAME);
      } else {
        svg.remove();

        document.getElementById('cbxExpanded').checked = true;
        initVerticalTree(FILENAME);
      }
    }

    Array.prototype.forEach.call(radios, function (radio) {
      radio.addEventListener('change', changeHandler);
    });

    document.getElementById('cbxExpanded').addEventListener('change', function () {
      document.getElementsByClassName('node')[0].dispatchEvent(new Event('click'));
    });

    
    // document.getElementById('btn-search').addEventListener('click', function () {
    //   var searchText = document.getElementById('search-text').value;

    //   // d3 magic to find the node and zoom to it
    //   scale = zoomListener.scale();
    //   x = 1;
    //   y = 1;
    //   x = x * scale + width / 2;
    //   y = y * scale + height / 2;
    //   d3.select('g').transition()
    //     .duration(duration)
    //     .attr("transform", "translate(" + x + "," + y + ")scale(" + scale + ")");
    //   zoomListener.scale(scale);
    //   zoomListener.translate([x, y]);
    // });
  </script>
</body>